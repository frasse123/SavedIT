<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
    />
    <title>Saved it</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="icon" href="icons/icon-192.png" />
    <!-- iOS-ikon i roten -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png?v=11" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <!-- Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root{
        --accent:#0f766e; --accent-2:#0ea5a3;
        --bg:#f6f8fb; --surface:#ffffff;
        --text:#0f172a; --muted:#6b7280;
        --border:#e8eaf0; --ring:rgba(14,165,233,.18);
        --green:#22c55e; --red:#ef4444;
      }
      :root { color-scheme: light; }
      html { -webkit-text-size-adjust: 100%; }
      *,*::before,*::after{ box-sizing:border-box; }
      html,body{ width:100%; max-width:100%; overflow-x:hidden; }
      body{ font-family: Inter, system-ui,-apple-system, Segoe UI, Roboto, sans-serif; margin:0; color:var(--text); background:var(--bg); }

      /* HERO */
      .hero{
        background:
          radial-gradient(1200px 300px at 30% -10%, #bff0ec 0%, transparent 60%),
          linear-gradient(135deg, #d8f4f1 0%, #eaf6ff 40%, #f7f9ff 100%);
        padding: max(28px, calc(env(safe-area-inset-top) + 18px)) 0 22px;
        border-bottom: 1px solid var(--border);
      }
      .wrap{ max-width: 960px; margin: 0 auto; padding: 0 22px; }
      .top{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
      .brand{ display:flex; align-items:center; gap:12px; }
      .logo{ width: 38px; height: 38px; border-radius: 12px; background: conic-gradient(from 200deg, var(--accent), var(--accent-2)); box-shadow: 0 6px 18px rgba(15,118,110,.25), inset 0 1px 3px rgba(255,255,255,.6); }
      .brand h1{ font-size: 28px; line-height:1.1; margin:0; letter-spacing:-0.01em; }
      .subtitle{ color:var(--muted); margin:6px 0 0 50px; }

      .content{ max-width: 960px; margin: 0 auto; padding: 18px 22px 40px; }

      /* Inputs och kort */
      .row{ display:grid; grid-template-columns: 1fr 160px auto; gap: 10px; margin: 10px 0 18px; }
      @media (max-width: 560px){ .row{ grid-template-columns: 1fr; } }
      input[type="text"], input[type="number"]{
        width:100%; max-width:100%; min-width:0;
        padding: 12px 14px; border:1px solid var(--border); border-radius: 12px; background:#fff;
        font-size:17px !important; color:var(--text); caret-color:var(--text);
        outline:none; transition: border-color .15s, box-shadow .15s; box-shadow: 0 1px 0 rgba(15,23,42,.03);
      }
      input::placeholder{ color:#9aa0a6; opacity:1; }
      input:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }
      input:-webkit-autofill{ -webkit-text-fill-color: var(--text) !important; box-shadow: 0 0 0 1000px #fff inset; -webkit-box-shadow: 0 0 0 1000px #fff inset; }

      .btn{ padding: 11px 14px; border-radius: 12px; border:1px solid var(--border); background:#fff; color:var(--text); cursor:pointer; font-weight:600; transition: transform .06s, box-shadow .15s; box-shadow: 0 1px 0 rgba(15,23,42,.05); }
      .btn:active{ transform: translateY(1px); }
      .btn-add{ background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff; border-color:transparent; box-shadow: 0 8px 20px rgba(15,118,110,.25); }

      .card{ background: var(--surface); border:1px solid var(--border); border-radius: 16px; box-shadow: 0 2px 12px rgba(15,23,42,.06); }
      .list-item{ display:flex; align-items:center; justify-content:space-between; gap:14px; padding: 14px 16px; border-bottom: 1px solid var(--border); }
      .list-item:last-child{ border-bottom: 0; }

      .actions{ display:flex; gap: 8px; }
      .save   { background: #22c55e; border-color:#22c55e; color:#fff; }
      .danger { background: #ef4444; border-color:#ef4444; color:#fff; }

      .section{ display:flex; align-items:center; justify-content:space-between; margin: 22px 0 12px; }
      .section h3{ margin:0; font-size: 16px; letter-spacing: .02em; color:#111; }
      .muted{ color:var(--muted); font-style:italic; text-align:center; margin:12px 0; }

      .summary{ display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin:12px 0 16px; }
      @media (max-width: 560px){ .summary{ grid-template-columns: 1fr; } }
      .sum-card{ background:#fff; border:1px solid var(--border); border-radius:14px; padding:12px 14px; box-shadow:0 2px 10px rgba(15,23,42,.04); }
      .sum-label{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.04em; margin-bottom:6px; }
      .sum-value{ font-size:18px; font-weight:700; }

      .stats{ position: sticky; bottom: 0; margin-top: 18px; padding: 14px 16px; background: var(--surface); border:1px solid var(--border); border-radius: 14px; box-shadow: 0 -1px 10px rgba(15,23,42,.06); }
      .empty{ text-align:center; color: var(--muted); padding: 18px 10px; }

      /* ========= HAMBURGER + DRAWER ========= */
      .hamburger{
        width:42px; height:42px; display:inline-flex; align-items:center; justify-content:center;
        border:1px solid var(--border); border-radius:12px; background:#fff; cursor:pointer;
        box-shadow:0 1px 0 rgba(15,23,42,.05);
      }
      .ham-lines{ position:relative; width:20px; height:2px; background:#334155; border-radius:2px; }
      .ham-lines::before,.ham-lines::after{
        content:""; position:absolute; left:0; width:20px; height:2px; background:#334155; border-radius:2px;
      }
      .ham-lines::before{ top:-6px; } .ham-lines::after{ top:6px; }

      .drawer{
        position: fixed; z-index: 60; inset:0 auto 0 0; width: 280px; max-width: 85vw;
        background:#fff; border-right:1px solid var(--border);
        transform: translateX(-100%); transition: transform .25s ease;
        padding: calc(env(safe-area-inset-top) + 12px) 16px 16px;
        display:flex; flex-direction:column; gap:6px;
      }
      .drawer.open{ transform: translateX(0); }
      .drawer .menu-title{ font-weight:700; margin:6px 2px 10px; color:#0f172a; }
      .nav-item{
        width:100%; text-align:left; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
        background:#fff; font-weight:600; color:#334155; cursor:pointer;
      }
      .nav-item.active{
        background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff; border-color:transparent;
      }
      .overlay{
        position: fixed; inset:0; background: rgba(0,0,0,.28); backdrop-filter: blur(1px);
        z-index: 50; opacity:0; pointer-events:none; transition: opacity .2s ease;
      }
      .overlay.show{ opacity:1; pointer-events:auto; }
      body.lock-scroll{ overflow:hidden; }
      /* ====================================== */
    </style>
  </head>

  <body>
    <header class="hero">
      <div class="wrap">
        <div class="top">
          <div class="brand">
            <button id="hambtn" class="hamburger" aria-label="Meny" aria-controls="app-drawer" aria-expanded="false">
              <span class="ham-lines" aria-hidden="true"></span>
            </button>
            <div class="logo" aria-hidden="true"></div>
            <h1>Saved it</h1>
          </div>
          <p class="subtitle">Logga impulsköp du avstår. Spara pengar. Allt lagras lokalt på enheten.</p>
        </div>
      </div>
    </header>

    <main class="content">
      <div id="root"></div>
    </main>

    <!-- React via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      /* ====== Statiska vyer i menyn ====== */
      const VIEWS = [
        ["overview","Översikt"],
        ["goals","Sparmål"],
        ["insights","Insikter"],
        ["history","Historik"],
        ["categories","Kategorier"],
        ["settings","Inställningar"],
        ["about","Om"],
        ["feedback","Feedback"],
      ];

      /* ====== Storage helpers ====== */
      const load = (k, f) => { try{ const v = localStorage.getItem(k); return v? JSON.parse(v): f; } catch { return f; } };
      const saveLS = (k, v) => localStorage.setItem(k, JSON.stringify(v));

      /* ====== Datum-hjälp för översiktens period ====== */
      const toDate = (iso) => new Date(iso);
      const stripTime = (d) => new Date(d.getFullYear(), d.getMonth(), d.getDate());
      const startOfWeek = (d) => { const day = d.getDay(); const diff = (day === 0 ? -6 : 1) - day; const s = new Date(d); s.setDate(d.getDate()+diff); return stripTime(s); };
      const startOfMonth = (d) => new Date(d.getFullYear(), d.getMonth(), 1);
      const startOfYear  = (d) => new Date(d.getFullYear(), 0, 1);
      const isInRange = (date, start) => stripTime(date) >= stripTime(start);

      /* ====== Drawer-komponent ====== */
      function Drawer({open, view, onSelect, onClose}){
        useEffect(() => {
          const onEsc = (e)=>{ if(e.key === "Escape") onClose(); };
          if(open) document.addEventListener("keydown", onEsc);
          return ()=> document.removeEventListener("keydown", onEsc);
        }, [open, onClose]);

        useEffect(() => {
          document.body.classList.toggle("lock-scroll", open);
          const btn = document.getElementById("hambtn");
          if(btn) btn.setAttribute("aria-expanded", open ? "true" : "false");
        }, [open]);

        return (
          <>
            <div id="app-drawer" className={"drawer"+(open?" open":"")} role="dialog" aria-modal="true" aria-label="Meny">
              <div className="menu-title">Meny</div>
              {VIEWS.map(([key,label])=>(
                <button
                  key={key}
                  className={"nav-item"+(view===key?" active":"")}
                  onClick={()=>{ onSelect(key); onClose(); }}
                  type="button"
                >
                  {label}
                </button>
              ))}
            </div>
            <div className={"overlay"+(open?" show":"")} onClick={onClose} />
          </>
        );
      }

      /* ====== Översiktens komponent (din befintliga logik) ====== */
      function Overview({items, saved, setItems, setSaved}){
        const [newName, setNewName] = useState("");
        const [newPrice, setNewPrice] = useState("");
        const [tab, setTab] = useState("week"); // week | month | year | all

        useEffect(()=>saveLS("items", items), [items]);
        useEffect(()=>saveLS("saved", saved), [saved]);

        const addItem = () => {
          if(!newName.trim() || !newPrice.trim()){ alert("Fyll i både namn och pris"); return; }
          const price = Number(newPrice.replace(",", "."));
          if(Number.isNaN(price) || price <= 0){ alert("Ange ett giltigt pris"); return; }
          setItems(prev => [...prev, { id:String(Date.now()), name:newName.trim(), price }]);
          setNewName(""); setNewPrice("");
        };
        const removeItem = (id) => setItems(prev => prev.filter(i=>i.id!==id));
        const saveMoney  = (item) => setSaved(prev => [{...item, sid:String(Date.now()), date:new Date().toISOString()}, ...prev]);
        const deleteSaved= (sid) => setSaved(prev => prev.filter(s => s.sid !== sid));
        const clearHistory = () => { if(confirm("Rensa hela historiken?")) setSaved([]); };

        const today = new Date();
        const periodStart = useMemo(() => {
          if(tab==="week")  return startOfWeek(today);
          if(tab==="month") return startOfMonth(today);
          if(tab==="year")  return startOfYear(today);
          return new Date(0);
        }, [tab]);

        const filtered = useMemo(() => saved.filter(s => isInRange(toDate(s.date), periodStart)), [saved, periodStart]);
        const totalSavedAll    = useMemo(()=> saved.reduce((a,s)=>a+(+s.price||0),0), [saved]);
        const totalSavedPeriod = useMemo(()=> filtered.reduce((a,s)=>a+(+s.price||0),0), [filtered]);

        const tabLabel = {week:"Vecka", month:"Månad", year:"År", all:"Alla"}[tab];

        return (
          <>
            {/* Inmatning */}
            <div className="row">
              <input type="text" placeholder="Namn (t.ex. Latte)" value={newName} onChange={e=>setNewName(e.target.value)} />
              <input type="number" step="0.01" placeholder="Pris" value={newPrice} onChange={e=>setNewPrice(e.target.value)} />
              <button className="btn btn-add" onClick={addItem}>Lägg till</button>
            </div>

            {/* Möjliga impulsköp */}
            {items.length === 0 && <div className="empty">Inga impulsköp tillagda ännu.</div>}
            {items.length > 0 && (
              <div className="card" style={{marginBottom:12}}>
                {items.map(item=>(
                  <div className="list-item" key={item.id}>
                    <div><strong>{item.name}</strong> <span className="muted">({item.price} kr)</span></div>
                    <div className="actions">
                      <button className="btn save" onClick={()=>saveMoney(item)}>Avstod</button>
                      <button className="btn danger" onClick={()=>removeItem(item.id)}>Ta bort</button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Period-kort */}
            <div className="section"><h3>Översikt</h3></div>
            <div style={{display:"flex", gap:8, flexWrap:"wrap", margin:"8px 0 10px"}}>
              {["week","month","year","all"].map(key=>(
                <button
                  key={key}
                  className={"btn"+(tab===key?" btn-add":"")}
                  onClick={()=>setTab(key)}
                  type="button"
                >
                  {({week:"Vecka",month:"Månad",year:"År",all:"Alla"})[key]}
                </button>
              ))}
            </div>

            <div className="summary">
              <div className="sum-card">
                <div className="sum-label">Totalt sparat – {tabLabel.toLowerCase()}</div>
                <div className="sum-value">{totalSavedPeriod.toFixed(2)} kr</div>
              </div>
              <div className="sum-card">
                <div className="sum-label">Antal avståenden</div>
                <div className="sum-value">{filtered.length}</div>
              </div>
              <div className="sum-card">
                <div className="sum-label">Totalt (alla tider)</div>
                <div className="sum-value">{totalSavedAll.toFixed(2)} kr</div>
              </div>
            </div>

            {/* Historik */}
            <div className="section">
              <h3>Historik – {tabLabel.toLowerCase()}</h3>
              {saved.length>0 && <button className="btn danger" onClick={clearHistory}>Rensa all historik</button>}
            </div>

            {filtered.length===0 && <div className="empty">Du har inte avstått något i vald period.</div>}
            {filtered.length>0 && (
              <div className="card">
                {filtered.slice(0,100).map(s=>(
                  <div className="list-item" key={s.sid}>
                    <div><strong>{s.name}</strong> <span className="muted">{s.price} kr</span></div>
                    <div className="actions">
                      <span className="muted" style={{alignSelf:"center"}}>{new Date(s.date).toLocaleString()}</span>
                      <button className="btn danger" onClick={()=>deleteSaved(s.sid)}>Ta bort</button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <div className="stats"><b>Totalt sparat: {totalSavedAll.toFixed(2)} kr</b></div>
          </>
        );
      }

      /* ====== Huvudapp med drawer ====== */
      function App(){
        const [view, setView] = useState("overview");
        const [drawerOpen, setDrawerOpen] = useState(false);

        // Data som översikten använder
        const [items, setItems] = useState(()=>load("items", []));
        const [saved, setSaved] = useState(()=>load("saved", []));

        // Öppna/lukta via knapp i headern (utanför React)
        useEffect(()=>{
          const btn = document.getElementById("hambtn");
          if(!btn) return;
          const onClick = ()=> setDrawerOpen(true);
          btn.addEventListener("click", onClick);
          return ()=> btn.removeEventListener("click", onClick);
        },[]);

        // Enkel view-router
        const renderView = () => {
          switch(view){
            case "overview":
              return <Overview items={items} saved={saved} setItems={setItems} setSaved={setSaved} />;
            case "goals":
              return <div className="card" style={{padding:18}}><h3>Sparmål</h3><p className="muted">Lägg till dina mål här…</p></div>;
            case "insights":
              return <div className="card" style={{padding:18}}><h3>Insikter</h3><p className="muted">Diagram och trender kommer här…</p></div>;
            case "history":
              return <div className="card" style={{padding:18}}><h3>Historik</h3><p className="muted">Full historiklista…</p></div>;
            case "categories":
              return <div className="card" style={{padding:18}}><h3>Kategorier</h3><p className="muted">Hantera kategorier för dina impulsköp…</p></div>;
            case "settings":
              return <div className="card" style={{padding:18}}><h3>Inställningar</h3><p className="muted">Val för valuta, språk, export m.m.…</p></div>;
            case "about":
              return <div className="card" style={{padding:18}}><h3>Om</h3><p className="muted">Saved it – en enkel PWA för att spara pengar.</p></div>;
            case "feedback":
              return <div className="card" style={{padding:18}}><h3>Feedback</h3><p className="muted">Har du förslag? Skriv ner dem här!</p></div>;
            default:
              return null;
          }
        };

        return (
          <>
            <Drawer
              open={drawerOpen}
              view={view}
              onSelect={setView}
              onClose={()=>setDrawerOpen(false)}
            />
            {renderView()}
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);

      // Service worker (PWA)
      if('serviceWorker' in navigator){
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js');
        });
      }
    </script>
  </body>
</html>
